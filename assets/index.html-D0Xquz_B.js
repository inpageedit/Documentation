import{_ as n,c as s,a as e,o as t}from"./app-BUO_Z_l1.js";const p={};function i(c,a){return t(),s("div",null,a[0]||(a[0]=[e(`<h1 id="inpageedit-开发指南" tabindex="-1"><a class="header-anchor" href="#inpageedit-开发指南"><span>InPageEdit 开发指南</span></a></h1><h2 id="系统要求" tabindex="-1"><a class="header-anchor" href="#系统要求"><span>系统要求</span></a></h2><ul><li>Node.js &gt;= 18.16.0</li><li>Git</li></ul><h2 id="开发指引" tabindex="-1"><a class="header-anchor" href="#开发指引"><span>开发指引</span></a></h2><p>这个段落将指导您如何在本地开发与打包 InPageEdit (以下简称 IPE)。</p><h3 id="克隆代码仓库" tabindex="-1"><a class="header-anchor" href="#克隆代码仓库"><span>克隆代码仓库</span></a></h3><p>IPE 使用 Git 进行版本控制，您可以使用以下命令克隆代码仓库到本地：</p><p><code>git clone git@github.com:inpageedit/inpageedit-v2.git</code></p><p>我们强烈建议您新建一个分支，例如<code>yourname/dev</code>，并切换到该分支进行开发：</p><p><code>git checkout -b yourname/dev</code></p><p>另外，每次开发前从远程仓库的主分支同步是一个好习惯：</p><p><code>git merge origin/master</code></p><h3 id="依赖管理" tabindex="-1"><a class="header-anchor" href="#依赖管理"><span>依赖管理</span></a></h3><p>IPE 使用 <strong>pnpm</strong> 进行包管理。如果您没有安装 pnpm，可以使用<code>npm i -g pnpm</code>安装。</p><p><code>pnpm install</code></p><h3 id="自动重新编译" tabindex="-1"><a class="header-anchor" href="#自动重新编译"><span>自动重新编译</span></a></h3><p>使用 <code>pnpm dev</code> 启动开发服务器。</p><p>在 MediaWiki 中引用 <code>http://127.0.0.1:1225/InPageEdit.js</code> 载入本地的 IPE 脚本。当你修改 IPE 的源码时，打包器会自动重新编译该文件。</p><p>目前 IPE 的开发过程中还不支持 HMR (模块热更新)，在修改源码后请手动刷新网页加载最新的内容。</p><p>您可以在个人 JS 页面使用以下代码取代 IPE 的安装代码，以便在开发服务器启动时载入本地的 IPE 脚本，其他时候载入线上的 IPE 脚本：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;http://127.0.0.1:1225/InPageEdit.js?_=&#39;</span> <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&#39;[InPageEdit] Enable dev mode&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&#39;[InPageEdit] Cannot fetch dev server&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    mw<span class="token punctuation">.</span>loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&#39;https://unpkg.com/mediawiki-inpageedit&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="测试" tabindex="-1"><a class="header-anchor" href="#测试"><span>测试</span></a></h3><p>我们强烈建议您在提交代码前使用使用 eslint 进行代码检查：</p><p><code>pnpm test</code></p><p>虽然 eslint 并不能检查诸如逻辑错误之类的高级问题，但是它可以检查出一些常见的语法错误或者代码风格问题，例如哪里少了个缩进、哪里多了个空格、哪个变量导入了但是没有引用等等。</p><h3 id="打包" tabindex="-1"><a class="header-anchor" href="#打包"><span>打包</span></a></h3><p>使用以下命令打包 IPE：</p><p><code>pnpm build</code></p><p>IPE 当前使用 vite 进行打包，打包后的文件位于<code>dist</code>目录下。</p><p>您不必在打包前手动清理<code>dist</code>目录，执行 build 命令时会清理该目录。</p><h2 id="版本命名方针" tabindex="-1"><a class="header-anchor" href="#版本命名方针"><span>版本命名方针</span></a></h2><p>IPE 的版本号遵循<a href="https://semver.org/lang/zh-CN/" target="_blank" rel="noopener noreferrer">语义化版本</a>规范。额外的，IPE 版本号的非稳定版本部分是由特定的先行标签和自然数组成的，两者之间使用一个<code>.</code>连接。</p><ul><li>稳定版本的版本号示例：<code>1.0.0</code></li><li>先行版本的版本号示例：<code>1.0.0-alpha.0</code>。</li></ul><p>我们规定以下先行版本标签：</p><table><thead><tr><th>标签</th><th>名称</th><th>说明</th></tr></thead><tbody><tr><td><code>alpha</code></td><td>内部测试版</td><td>一般是作者对新添加的特性进行技术验证时使用，这些特性在线上环境和本地环境可能存在不兼容的情况，或者存在严重的 bug。</td></tr><tr><td><code>beta</code></td><td>外部测试版</td><td>一般是作者分发给愿意参加测试的用户使用，它们可能包含一些未完成的特性，或者存在一些已知的 bug。</td></tr><tr><td><code>pre</code></td><td>预发布版</td><td>一般与最终版本相同，它们不会再包含新的特性，但是可能包含一些 bug 修复。</td></tr></tbody></table><h2 id="标签-tag-方针" tabindex="-1"><a class="header-anchor" href="#标签-tag-方针"><span>标签（tag）方针</span></a></h2><ul><li>最新稳定版：<code>latest</code></li><li>最新先行版：<code>canary</code></li></ul><h2 id="代码风格方针" tabindex="-1"><a class="header-anchor" href="#代码风格方针"><span>代码风格方针</span></a></h2><p>IPE 使用<code>prettier</code>规范代码风格，在编撰完毕后，请使用<code>prettier --check &lt;file&gt;</code>检查风格是否符合标准，也可以使用<code>pnpm pretty</code>直接格式化全部文件。</p><p>IPE 的风格配置可以在 <a href="https://github.com/inpageedit/inpageedit-v2/tree/HEAD/.prettierrc.cjs" target="_blank" rel="noopener noreferrer">.prettierrc.cjs</a> 找到，请不要更改此文件。</p><h2 id="版本发布指引" tabindex="-1"><a class="header-anchor" href="#版本发布指引"><span>版本发布指引</span></a></h2><h3 id="推送" tabindex="-1"><a class="header-anchor" href="#推送"><span>推送</span></a></h3><p>使用以下指令发布新的版本：</p><ul><li>推送稳定版：<code>npm publish</code></li><li>推送测试版：<code>npm publish --tag canary</code></li></ul><p>您不必在发布前进行一次打包，因为我们配置了 prepublish 脚本，它会在每次发布前完成准备工作。</p><p>但是，记住在发布前更新版本号，否则可能会导致发布失败。</p><h3 id="撤回版本" tabindex="-1"><a class="header-anchor" href="#撤回版本"><span>撤回版本</span></a></h3><p>有时候错误的推送了未完成的代码，这时候需要撤回发布。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">npm</span> unpublish <span class="token string">&quot;mediawiki-inpageedit@&lt;version&gt;&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="移动-tag" tabindex="-1"><a class="header-anchor" href="#移动-tag"><span>移动 tag</span></a></h3><p>有时候会将测试版错误标记为稳定版发布，这时候需要将<code>latest</code>标记重新指向稳定版。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># 查看所有 tag</span></span>
<span class="line"><span class="token function">npm</span> dist-tag</span>
<span class="line"><span class="token comment"># 移动 tag</span></span>
<span class="line"><span class="token function">npm</span> dist-tag <span class="token function">add</span> <span class="token string">&quot;mediawiki-inpageedit@&lt;version&gt;&quot;</span> <span class="token operator">&lt;</span>tag<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,52)]))}const d=n(p,[["render",i]]),l=JSON.parse('{"path":"/develop/","title":"InPageEdit 开发指南","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1744982503000,"contributors":[{"name":"dragon-fish","username":"dragon-fish","email":"dragon-fish@qq.com","commits":1,"url":"https://github.com/dragon-fish"}],"changelog":[{"hash":"aa4f9bb6393acdca70b430fbc9e6cf3d1b7f44d4","time":1744982503000,"email":"dragon-fish@qq.com","author":"dragon-fish","message":"chore: 14.5.2 update logs"}]},"filePathRelative":"develop/README.md"}');export{d as comp,l as data};
